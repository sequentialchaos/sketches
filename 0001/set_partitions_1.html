<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Set Partitions</title>
  <script src="../../lib/scmath.js"></script>
  <script src="../../lib/p5.min.js"></script>
  <script src="../../lib/p5.dom.min.js"></script>
</head>

<body>
  <script type="text/javascript">
    let partitions;
    let side;
    let N;
    let hue;
    let interval;
    let currentIndex;
    let button;

    function setup() {
      side = 800;
      N = 4;
      hue = 0;
      interval = 500;

      button = createButton("Show partitions");
      createP("");
      createCanvas(side, side);
      background(207);

      button.mousePressed(function () {
        // Get all set partitions of {1, 2, ..., N}
        partitions = [];
        for (let partition of setPartitions(N))
          partitions.push(partition);

        // Sort set partitions by most blocks
        partitions.sort(p => -p.length);

        // Get the first partition
        currentIndex = 0;
        let partition = partitions[currentIndex];

        // Draw first partition
        drawFrame(partition);

        // Draw each subsequent partition after the given interval
        setInterval(function () {
          if (currentIndex < partitions.length - 1)
            currentIndex++;
          else 
            return;
          partition = partitions[currentIndex];
          drawFrame(partition)
        }, interval);
      });

    }

    function drawFrame(partition) {
      background(207);
      drawPartition(partition);
      drawVertices();
      text((currentIndex + 1) + " / " + partitions.length, side * 0.93, side * 0.97);
      text(partition, side * 0.03, side * 0.97);
    }

    function coordinates(index) {
      let angle = TWO_PI / N;
      let cx = side / 2,
        cy = side / 2;
      let radius = side * 2 / 5;
      let x = cx + cos(index * angle - TWO_PI / 4) * radius;
      let y = cy + sin(index * angle - TWO_PI / 4) * radius;
      return { x: x, y: y }
    }

    function drawLines(block) {
      if (block.length <= 1)
        return;
      for (let i = 0; i < block.length; i++) {
        let v1 = block[i],
          v2 = block[(i + 1) % block.length],
          c1 = coordinates(v1),
          c2 = coordinates(v2);
        strokeWeight(7);
        line(c1.x, c1.y, c2.x, c2.y);
      }
    }

    function drawPartition(partition) {
      partition.forEach(block => {
        drawLines(block);
      });
    }

    function drawVertices() {
      for (let i = 0; i < N; i++) {
        let coords = coordinates(i, N, side, side);
        let radius = side / 15;

        strokeWeight(5);
        ellipse(coords.x, coords.y, radius, radius);
        textAlign(CENTER, CENTER);
        textSize(radius / 2);
        text(i, coords.x, coords.y);
      }
    }

    function arrayToSetString(array) {

    }

    function textPartition(partition) {

    }
  </script>
  </div>
</body>

</html>