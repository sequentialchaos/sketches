<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Set Partitions</title>
  <script src="../lib/scmath.js"></script>
  <script src="../lib/p5.min.js"></script>
  <script src="../lib/p5.dom.min.js"></script>
  <script src="../lib/CCapture.all.min.js"></script>
  <script src="../lib/gif.worker.js"></script>
</head>

<body>

  <script type="text/javascript">
    var capturer = new CCapture({
      framerate: 60,
      format: 'gif',
      workersPath: "../lib/",
      verbose: true
    });
  </script>

  <script type="text/javascript">
    let partitions;
    let canvas;
    let side;
    let N;
    let hue;
    let interval;
    let currentIndex;
    let slider1, slider2, button;
    let timer;

    function setup() {
      slider1 = createSlider(2, 10, 7);
      slider2 = createSlider(1, 1000, 500);
      button = createButton("Show partitions");

      N = slider1.value();
      hue = 0;
      interval = 500;

      createElement("br");
      createElement("br");
      side = 800;
      var p5canvas = createCanvas(side, side);
      canvas = p5canvas.canvas;
      background(207);
      // capturer.start();

      clearInterval(timer);

      N = slider1.value();
      interval = slider2.value();
      console.log(N);
      partitions = getPartitions(N);
      currentIndex = 0;

    }

    function draw() {
      partition = partitions[currentIndex];
      drawFrame(partition);
      // capturer.capture(canvas);
      if (currentIndex >= partitions.length - 1) {

      }
      if (frameCount % 1 == 0) {
        if (currentIndex < partitions.length - 1) {
          currentIndex++;
        } else {
          // capturer.stop();
          // capturer.save();
        }
      }
      console.log(frameCount, currentIndex, partitions.length);
    }

    function drawFrame(partition) {
      background(207);
      drawPartition(partition);
      drawVertices();
      drawCount();
      drawTitle();
    }
    function drawLines(block) {
      if (block.length <= 1)
        return;
      for (let i = 0; i < block.length; i++) {
        let v1 = block[i],
          v2 = block[(i + 1) % block.length],
          c1 = coordinates(v1),
          c2 = coordinates(v2);
        strokeWeight(7);
        line(c1.x, c1.y, c2.x, c2.y);
      }
    }

    function drawPartition(partition) {
      partition.forEach(block => {
        drawLines(block);
      });
    }

    function drawVertices() {
      for (let i = 0; i < N; i++) {
        let coords = coordinates(i, N, side, side);
        let radius = side / 10;

        strokeWeight(7);
        ellipse(coords.x, coords.y, radius, radius);
        textFont('Cambria');
        textAlign(CENTER, CENTER);
        textSize(radius / 2);
        text(i+1, coords.x, coords.y);
      }
    }

    function drawCount() {
      textAlign(RIGHT, BOTTOM);
      textSize(30);
      textStyle(BOLD);
      textFont('Calibri');
      text((currentIndex + 1) + " / " + partitions.length, side * 0.985, side * 0.985);
    }

    function drawTitle() {
      textAlign(LEFT, TOP);
      textSize(45);
      textStyle(BOLD);
      textFont('Calibri');
      text(N + "-element set partitions", side * 0.015, side * 0.015);
    }

    function getPartitions(N) {
      // Get all set partitions of {0, 1, ..., N-1}
      partitions = [];
      for (let partition of setPartitions(N))
        partitions.push(partition);
      return partitions;
    }

    function coordinates(index) {
      let angle = TWO_PI / N;
      let cx = side / 2,
        cy = side / 2;
      let radius = side * 32 / 100;
      let x = cx + cos(index * angle - TWO_PI / 4) * radius;
      let y = cy + sin(index * angle - TWO_PI / 4) * radius;
      return { x: x, y: y }
    }



    function arrayToSetString(array) {

    }

    function textPartition(partition) {

    }
  </script>
  </div>
</body>

</html>